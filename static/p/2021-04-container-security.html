<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">

	<title>Container Security</title>

	<meta name="description" content="Our plan to secure containers">
	<meta name="author" content="i511895">

	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="reveal.js/dist/reset.css">
	<link rel="stylesheet" href="reveal.js/dist/reveal.css">
	<link rel="stylesheet" href="reveal.js/dist/theme/black.css" id="theme">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css" id="highlight-theme">
	<link rel="stylesheet" href="sap.css">
</head>

<body>

	<div class="reveal">

		<!-- Any section element inside of this container is displayed as a slide -->
		<div class="slides">

			<section
				style="text-align: left; background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/4/4e/Docker_%28container_engine%29_logo.svg/1280px-Docker_%28container_engine%29_logo.svg.png') bottom right no-repeat ; background-size: 280px;">
				<img src="assets/SAP.svg" alt="SAP Logo" style="background: transparent; border: none; height: 1em;" />
				<h1><small>How we get and keep FSM secure at<span class="yellow"> container level</span></small></h1>
				<p style="margin-top: 2rem;"><small>Dominik Meyer, SAP</small></p>
				<p style="font-size: 1.8rem;"><small>Internal</small></p>
				<p style="font-size: 1.8rem;"><small>Created with <a href="https://revealjs.com" target="_blank">reveal.js
							â¤ï¸</a></small></p>
			</section>

			<section>
				<h2><span class="yellow">Goal ğŸ¯</span></h2>
				<p>
					We want to understand:
				</p>
				<ul>
					<li>what container vulnerabilities are</li>
					<li>how vulnerabilities get into our containers</li>
					<li>how they get out again</li>
					<li>how we can avoid "introducing" them in the future</li>
					<li>what you need to do in the <span class="yellow">future</span>!</li>
				</ul>
			</section>

			<section>
				<h2><span class="yellow">Whom</span> do we scan for?</h2>
				<ul>
					<li><b>Our customer - they like their data secure âš ï¸</b></li>
					<li>Us - we like engineering challenges and a secure product (because our customer likes it)</li>
					<li>SAP - GDPR violations can cost up to 2-4% of yearly turnover ğŸ’¸ <small>for SAP: 500m</small></li>
				</ul>
			</section>

			<section>
				<section>
					<h2>Container <span class="yellow">vulnerabilities</span></h2>
				</section>
				<section>
					<h2>Container anatomy</h2>
					<p>Let us examine how containers and their layers actually work.</p>
					<p>âœğŸ½</p>
				</section>

				<section data-auto-animate>
					<h2 data-id="code-title">Dockerfile</h2>
					<pre data-id="code-animation"><code class="hljs" data-trim><script type="text/template">
							FROM repo/image-with-vulna:1.0.0
							COPY code-with-vulna-2 /bin/bad-code2
							RUN pip install bad-library:3.0.0
							#or install bad dependency 4
							RUN cd /bin/bad-code && npm install
							ENTRYPOINT /bin/bad-code/run
						</script></code></pre>
					<p>
						Docker images are immutable and this becomes a challenge now.
					</p>
				</section>

				<section data-auto-animate>
					<h2>Occurrence</h2>
					<ul>
						<li>Vulnerabilities can appear in any layer</li>
						<li>Layers contain means of executable code
							<ul>
								<li>copied into layer (e.g. our apps)</li>
								<li>installed by a dependency into the layer (e.g. <code>curl</code> installing <code>libssl</code>)</li>
							</ul>
						</li>
						<li>Code can contain two <code>variants</code> of vulnerability
							<ul>
								<li>ğŸ” already found ones</li>
								<li>ğŸª³ <b>not found ones</b> ğŸ”½</li>
							</ul>
						</li>
					</ul>
				</section>

				<section data-auto-animate>
					<h2>How can an image become <span class="yellow">insecure</span>?</h2>
					<ul>
						<li>We use pinned versions of a library <code>v1.1.3</code></li>
						<li>Researches find vulnerabilities in versions dating back <code>v1.1.3</code></li>
						<li>Since we use the <code>v1.1.3</code> a vulnerability is now present</li>
						<li>We have an <span style="color: red">insecure</span> image</li>
					</ul>
					<p>ğŸ¥› Its like milk. Last week it was good, today you better check before â˜•ï¸</p>
				</section>

				<section data-auto-animate>
					<h2>Finding</h2>
					<ul>
						<li>Vulnerabilities get (lets hope) found by researches, AI, etc.</li>
						<li>Get added to a vulnerability database (like <a href="https://cve.mitre.org/"
								target="_blank">cve.mitre.org</a>)</li>
						<li>Imported/synced from there by the scanning tools</li>
						<li>Scanning tools compare vulnerability db with docker image</li>
					</ul>
				</section>
				<section data-auto-animate>
					<h2>Scoring</h2>
					<ul>
						<li>Vulnerabilities are graded by a score (0-10)</li>
						<li>Score to word <code>high</code> depends on the scanning tools scale</li>
						<li>CVSS v3.1
							<ul>
								<li>Low: .1-3.9</li>
								<li>Medium: 4-6.9</li>
								<li>High: 7-8.9</li>
								<li><b>Critical</b>: 9-10</li>
							</ul>
						</li>
					</ul>
				</section>
			</section>

			<section data-auto-animate>
				<section>
					<h2>Counter <span class="yellow">measures</span></h2>
				</section>
				<section>
					<h2>Depending on severity (CVSS)</h2>
					<table>
						<tr>
							<th>CVSS Score</th>
							<th>Measure</th>
						</tr>
						<tr>
							<td>Critical</td>
							<td style="color: red">FSM: 72h <small>SAP: =high</small></td>
						</tr>
						<tr>
							<td>High</td>
							<td style="color: orange">1m <small>not acceptable for FSM, asap too</small></td>
						</tr>
						<tr>
							<td>Medium</td>
							<td style="color: lightblue">3m</td>
						</tr>
						<tr>
							<td>Low</td>
							<td style="color: blue">4m</td>
						</tr>
					</table>
				</section>
				<section data-auto-animate>
					<h2>First<span class="yellow"> measure</h2>
					<p>â° Regularly scan</p>
					<ul>
						<li>
							Vulnerabilities can be found in existing, immutable images/layers
						</li>
						<li>
							Therefor we need to scan regularly all our images and fix them
						</li>
						<li>
							As a special task force does that right now ğŸ¥µ
						</li>
						<li>
							This can be automated but not left away, every week new vulnerabilities get found
						</li>
					</ul>
				</section>

				<section data-auto-animate>
					<h2>Second<span class="yellow"> measure</h2>
					<p>called <br><code>Secure At Inception</code><br> and introduced in a minute</p>
				</section>

				<section data-auto-animate>
					<h2>Fixes ğŸ”</h2>
					<ul>
						<li>The vulnerability is already <b>in</b> our images</li>
						<li>Found in regular scan</li>
						<li>Apply fix, 99% update dependency in matching layer
							<ul><li>95% you do not use latest (base) image</li></ul>
						</li>
					</ul>
				</section>
				<section data-auto-animate>
					<h2>If there is no fix <code>(1%)</code>?</h2>
					<p>Rarely the case, but if, our CSO can request an exception</p>
					<p>Very fresh vulnerabilities might not have any fix yet, so we need to except and "wait"</p>
				</section>
			</section>

			<section data-auto-animate>
				<section>
					<h2>Secure <span class="yellow">At Inception</span></h2>
					<ul>
						<li>Term by <a href="https://sap-fsm.slack.com/archives/DJ8LYVD8R" target="_blank">@Dominik</a></li>
						<li>Before the regular scan appears, we already detect a new vulnerability <b>or</b></li>
						<li>It is <b>freshly</b> introduced by a code change <small>to the <code>Dockerfile</code></small></li>
						<li>This CI / PR tooling is currently getting implemented by engineering team</li>
					</ul>
				</section>
				<section>
					<h2><span class="yellow">CI</span> based</h2>
					<ul>
						<li>
							Two step process
						</li>
						<li>
							It will run checks on PR
							<ul>
								<li>Not updating <b>ANY</b> remote, registry or tool</li>
								<li>Detecting vulnerabilities/problems in all layers (incl. ours)</li>
							</ul>
						</li>
						<li>
							On push / after merge (as part of CD)
							<ul>
								<li>Updating <b>all</b> remotes SAP-compliant</li>
								<li>70% using <code>piper</code></li>
							</ul>
						</li>
						<li>With this we separate CI from CD, forcing us to only introduce <span class="yellow">secure products</span> ğŸ”’!</li>
					</ul>
				</section>
				<section>
					<h1>Expected within weeks time ğŸ ğŸ’</h1>
				</section>
			</section>

			<section data-auto-animate>
				<section>
					<h2>â˜ï¸ Call to action</h2>
					<ul>
						<li>ğŸš“ Like in public: Do no longer look away! Call the <del>police</del> <ins>security-champions</ins></li>
						<li>
							Soon your PR will show a âŒ if any vulnerability is found. <b>Do not look away!</b>
						</li>
						<li>We work out a formal process to follow, until then do the following ğŸ”½ if your PR shows a
							<br /><small>container</small>vulnerability</li>
					</ul>
				</section>
				<section>
					<h2>â˜ï¸ Call to action - Steps</h2>
					<ol>
						<li>Check that you use the latest (base) image
							<ul>
								<li>Java services must use latest parent</li>
								<li>Node services must use latest (base) <code>FROM</code> image</li>
							</ul>
						</li>
						<li>
							Report it as follows ğŸ”½
						</li>
						<li>
							Of course, 300 IQ play is to make a PR towards the base with the fixed version ğŸ¤¯
						</li>
					</ol>
				</section>
				<section>
					<h2><span class="yellow">Escalating</span> <small>container</small> vulnerabilities</h2>
					<table>
						<tr>
							<th>CVSS Score</th>
							<th>Measure</th>
						</tr>
						<tr>
							<td>Unknown or >= 7</td>
							<td style="color: red">
								<ol>
									<li>Inform <a href="https://sap-fsm.slack.com/archives/CSUM8BX71"
											target="_blank">#security-champions</a></li>
									<li>Notify <a href="https://sap-fsm.slack.com/archives/D01P250H8DA" target="_blank">Rakesh</a> and <a
											href="https://sap-fsm.slack.com/archives/DJ8LYVD8R" target="_blank">Dominik</a></li>
								</ol>
							</td>
						</tr>
						<tr>
							<td>
								<7</td>
							<td style="color: orange">
								<ol>
									<li>Inform <a href="https://sap-fsm.slack.com/archives/CSUM8BX71"
											target="_blank"></a>#security-champions</a></li>
								</ol>
							</td>
						</tr>
					</table>
				</section>
				<section>
					<pre data-id="code-animation"><code class="hljs" data-trim><script type="text/template">
							Hi all,
							our scans show a vulnerability in <code>docker-base-webapp-nodejs-nginx</code>, see this <a href="#">scan</a>
							I already informed @rakesh and @dominik
							What should I do?
						</script></code></pre>
				</section>
			</section>

			<section data-auto-animate>
					<h2>Local scanning for explorers ğŸ§—ğŸ½â€â™‚ï¸</h2>
					<p>Only if interested, try <a
							href="https://pages.github.tools.sap/coresystemsFSM/docs/docs/tool-anchore-engine" target="_blank">local
							anchore scanning</a></p>
					<p>Image needs to be in your local registry or on a public one!</p>
					<pre data-id="code-animation"><code class="hljs" data-trim><script type="text/template">
							curl -s ht..inline_scan.. | bash -s -- full/image:tag
							curl -s h..inline_scan.. | bash -s -- wfm:latest 
							  locally compiled workforce management^
						</script></code></pre>
			</section>

			<section data-auto-animate>
				<h2>Anchore, <span class="yellow">WhiteSource</span>, Snyk?</h2>
				<ul>
					<li>SAP accepts two tools*, not more: Protecode and WhiteSource</li>
					<li>We can use Anchore for the time being, but need to migrate to WS</li>
					<small>
						<li>Yes, open source tools are better</li>
						<li><b>No, we can not use them!</b></li>
						<li>Yes, it is annoying</li>
						<li>Yes, SAP trails 5y behind the industry on that matter</li>
						<li>Yes, the developer experience is absolutely terrible</li>
						<li>ğŸ’ªğŸ¼ We take it as challenge and make it work ğŸ’¯</li>
					</small>
				</ul>
				<p><small>* for container scanning</small></p>
		</section>

			<section data-auto-animate>
				<h2>Goal control</h2>
				<ul class="goal">
					<li class="goal">what container vulnerabilities are</li>
					<li class="goal">how vulnerabilities get into our containers</li>
					<li class="goal">how they get out again</li>
					<li class="goal">how we can avoid "introducing" them in the future</li>
					<li class="goal">what you need to do in the<span class="yellow">&nbsp;future</span>! </li>
				</ul>
			</section>

			<section style="text-align: left;">
				<h2><span class="yellow">Thanks</span>
					<h2>
						<h2><small>Questions / Answers</small></h2>
						<p><small>Contact: <a href="mailto:dominik.meyer01@sap.com">dominik.meyer01@sap.com</a></small></p>
			</section>

		</div>

	</div>

	<script src="reveal.js/dist/reveal.js"></script>
	<script src="reveal.js/plugin/zoom/zoom.js"></script>
	<script src="reveal.js/plugin/notes/notes.js"></script>
	<script src="reveal.js/plugin/search/search.js"></script>
	<script src="reveal.js/plugin/markdown/markdown.js"></script>
	<script src="reveal.js/plugin/highlight/highlight.js"></script>
	<script>

		// Also available as an ES module, see:
		// https://revealjs.com/initialization/
		Reveal.initialize({
			controls: true,
			progress: true,
			center: true,
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealZoom, RevealNotes, RevealSearch, RevealMarkdown, RevealHighlight]
		});

	</script>

</body>

</html>